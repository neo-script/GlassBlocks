<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>GlassBlocks</title>

<link rel="icon" href="favicon.ico">

<link href="https://fonts.googleapis.com/css2?family=Shizuru&display=swap" rel="stylesheet">

<style>
/* (CSS unchanged ‚Äî trimmed here for readability in explanation)
   ‚ö†Ô∏è KEEP YOUR EXISTING CSS EXACTLY AS IS
   DO NOT REMOVE ANYTHING ABOVE THIS COMMENT
*/

/* ---------- AUDIO BUTTON ---------- */
.audio-btn{
  position:fixed;
  bottom:14px;
  right:14px;
  z-index:20;
  background:rgba(30,41,59,.7);
  border:1px solid rgba(255,255,255,.2);
  border-radius:999px;
  padding:10px 14px;
  cursor:pointer;
  font-family:'Shizuru', cursive;
  color:white;
  backdrop-filter: blur(6px);
}
.audio-btn.off{ opacity:.6; }
</style>
</head>

<body>

<!-- üîä AUDIO -->
<audio id="bgm" src="music.mp3" loop preload="auto"></audio>
<audio id="sfx" src="click.mp3" preload="auto"></audio>

<button id="audioBtn" class="audio-btn off">üîá</button>

<!-- EVERYTHING ELSE IN BODY STAYS EXACTLY THE SAME -->
<!-- emoji rain, game, board, tray, proxy, overlay, etc -->

<script>
/* =========================
   AUDIO SYSTEM
========================= */
const bgm = document.getElementById('bgm');
const sfx = document.getElementById('sfx');
const audioBtn = document.getElementById('audioBtn');

let audioEnabled = false;

function enableAudio(){
  if(audioEnabled) return;
  audioEnabled = true;

  bgm.volume = 0.35;
  sfx.volume = 0.6;

  bgm.play().catch(()=>{});
  audioBtn.textContent = 'üîä';
  audioBtn.classList.remove('off');
}

audioBtn.onclick = () => {
  if(!audioEnabled){
    enableAudio();
  } else {
    audioEnabled = false;
    bgm.pause();
    audioBtn.textContent = 'üîá';
    audioBtn.classList.add('off');
  }
};

function playClick(){
  if(!audioEnabled) return;
  sfx.currentTime = 0;
  sfx.play().catch(()=>{});
}

/* =========================
   HOOK AUDIO INTO GAME
========================= */
/* Call enableAudio() on first user action */
window.addEventListener('pointerdown', enableAudio, { once:true });

/* üîß INTEGRATION POINTS */
/* Add playClick() in TWO places ONLY */

/* 1Ô∏è‚É£ When a piece is successfully placed */
const _placeShape = placeShape;
placeShape = function(r,c){
  _placeShape(r,c);
  playClick();
};

/* 2Ô∏è‚É£ When lines clear */
const _clearLines = clearLines;
clearLines = function(){
  const didClear = _clearLines();
  if(didClear) playClick();
  return didClear;
};
</script>

</body>
</html>
